; ============================================================================================
; LUMINARY - a game engine and framework for the SEGA Mega Drive
; ============================================================================================
; Matt Phillips - Big Evil Corporation Ltd - 4th August 2019
; ============================================================================================
; ENTITY.ASM - Component based entity system
; ============================================================================================

    ; ======================================
    ; Entity block allocation data, auto-generated
    ; by ENTITY_BEGIN/ENTITY_END.
    ; ======================================
    STRUCT_BEGIN EntityBlockData
EntityBlock_Flags                       rs.w 1
EntityBlock_Next                        rs.w 1
    STRUCT_END

    ; ======================================
    ; Component slot description, auto-generated
    ; by ENTITY_BEGIN/ENTITY_END.
    ; ======================================
    STRUCT_BEGIN ComponentSlotDesc
ComponentSlotDesc_AddrOffset            rs.w 1
ComponentSlotDesc_SpawnDataOffset       rs.w 1
ComponentSlotDesc_LinkedList            rs.l 1
ComponentSlotDesc_Constructor           rs.l 1
ComponentSlotDesc_Destructor            rs.l 1
    STRUCT_END

    ; ======================================
    ; Entity spawn/despawn description,
    ; auto-generated by ENTITY_BEGIN/ENTITY_END.
    ; ======================================
    STRUCT_BEGIN EntityTypeDesc
EntityTypeDesc_NumComponents            rs.w 1
EntityTypeDesc_ComponentSlots           rs.l 1
EntityTypeDesc_Constructor              rs.l 1
EntityTypeDesc_Destructor               rs.l 1
EntityTypeDesc_Update                   rs.l 1
    STRUCT_END

    ; ======================================
    ; Entity base structure,
    ; auto-generated by ENTITY_BEGIN/ENTITY_END.
    ; ======================================
    STRUCT_INHERIT EntityBase,EntityBlockData
Entity_TypeDesc                         rs.l 1  ; Entity type
Entity_PosX                             rs.l 1  ; World pos X (16.16)
Entity_PosY                             rs.l 1  ; World pos Y (16.16)
Entity_ExtentsX                         rs.w 1  ; Width in pixels
Entity_ExtentsY                         rs.w 1  ; Height in pixels
    STRUCT_END

    ; ======================================
    ; Component base structure,
    ; auto-generated by ENTITY_BEGIN/ENTITY_END.
    ; ======================================
    STRUCT_INHERIT ComponentBase,EntityBlockData
Component_Owner                         rs.w 1  ; Owning entity
    STRUCT_END

Entity_Initialise:
    ; ======================================
    ; Initialises an entity - base constructor
    ; before component allocation.
    ; ======================================
    ; a0   Entity
    ; a1   Entity spawn data
    ; a5   Entity type desc
    ; d0.w Position X
    ; d1.w Position Y
    ; d2.w Width
    ; d3.w Height
    ; ======================================

    ; Set type desc
    move.l a5, Entity_TypeDesc(a0)

    ; Clear position fraction
    move.l #0x0, Entity_PosX(a0)
    move.l #0x0, Entity_PosY(a0)

    ; Set params
    move.w d0, Entity_PosX(a0)
    move.w d1, Entity_PosY(a0)
    move.w d2, Entity_ExtentsX(a0)
    move.w d3, Entity_ExtentsY(a0)

    rts